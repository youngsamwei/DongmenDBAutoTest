<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>201601060322_王文昊</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>01-exp_01_05_delete.c</CENTER></H3><HR>
<PRE>
<A NAME="0"></A>#include &lt;parser/statement.h&gt;
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match45-1.html#0',3,'match45-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>sql_stmt_delete *parse_sql_stmt_delete(ParserT *parser){
    char *wangwenhaotableName = NULL;
    if (!matchToken(parser, TOKEN_RESERVED_WORD, &quot;delete&quot;)) {
        return NULL;
    }
    TokenT *xiaotktoken = parseNextToken(parser);
    if(xiaotktoken-&gt;type == TOKEN_WORD){
        wangwenhaotableName = new_id_name();
        strcpy(wangwenhaotableName,xiaotktoken-&gt;text);
    }
    else{
        strcpy(parser-&gt;parserMessage, &quot;invalid sql: missing table name.&quot;);
        return NULL;
    }
    xiaotktoken = parseEatAndNextToken(parser);
    if (!matchToken(parser, TOKEN_RESERVED_WORD, &quot;where&quot;)) {
        strcpy(parser-&gt;parserMessage, &quot;invalid sql: should be where.&quot;);
        return NULL;
    }
    xiaotktoken = parseNextToken(parser);
    Expression *biaodashiwhereExpr = parseExpressionRD(parser);
    if(parser-&gt;parserStateType == PARSER_WRONG){
        return NULL;
    };
    TableReference_t *kanbudongref = TableReference_make(wangwenhaotableName,NULL);
    SRA_t * zhuozitable = SRATable(kanbudongref);
    zhuozitable-&gt;t = SRA_TABLE;
    SRA_t *  didianwhere = SRASelect(zhuozitable,biaodashiwhereExpr);
    didianwhere-&gt;t = SRA_SELECT;
    sql_stmt_delete *jiageqianzhuisqlstmtdelete = (sql_stmt_delete *)malloc(sizeof(sql_stmt_delete));
    jiageqianzhuisqlstmtdelete-&gt;tableName = wangwenhaotableName;
    jiageqianzhuisqlstmtdelete-&gt;where = didianwhere;
    return jiageqianzhuisqlstmtdelete;
};</B></FONT>
</PRE>
<HR>
<H3><CENTER>02-exp_07_06_delete.c</CENTER></H3><HR>
<PRE>
<A NAME="1"></A>#include &quot;physicalplan/physicalplan.h&quot;
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match45-1.html#1',3,'match45-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>int plan_execute_delete(dongmendb *db, sql_stmt_delete *sqlStmtDelete,  transaction *tx){
    int count = 0;
    physical_scan *wulijihuaplan = physical_scan_generate(db,sqlStmtDelete-&gt;where,tx);
    wulijihuaplan-&gt;beforeFirst(wulijihuaplan);
    if(wulijihuaplan != NULL)
    {
        while (wulijihuaplan-&gt;next(wulijihuaplan)){       //plan����ת��Ϊ��һ������������ֵ
            wulijihuaplan-&gt;deleterec(wulijihuaplan);
            count ++;
        }
        wulijihuaplan-&gt;close(wulijihuaplan);
    }
    return count ;//���ظı���Ŀ������
};</B></FONT>
</PRE>
</BODY>
</HTML>
